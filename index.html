<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spektra install - Panasonic Aquarea Protokol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f1f5f9;
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .page-container { 
                border: none !important; box-shadow: none !important; 
                width: 100%; max-width: 100%; margin: 0; padding: 2mm;
            }
            .section-header { 
                background-color: #f8fafc !important; color: #e11d48 !important; 
                border-bottom: 2px solid #e11d48 !important;
                -webkit-print-color-adjust: exact; print-color-adjust: exact;
            }
            input, select, textarea { border: none !important; background: transparent !important; color: black !important; -webkit-text-fill-color: black; opacity: 1; }
            .checkbox-custom { border: 1px solid #333 !important; -webkit-print-color-adjust: exact; }
            .device-section { display: none; }
            .device-section.active { display: block !important; }
        }

        .section-header { 
            background-color: #f1f5f9; color: #e11d48; padding: 6px 12px; 
            font-weight: 900; text-transform: uppercase; font-size: 10px; 
            letter-spacing: 1px; border-left: 5px solid #e11d48; margin-top: 14px;
        }

        .input-field { 
            border: 1px solid #e2e8f0; padding: 6px 10px; font-size: 15px; 
            width: 100%; border-radius: 6px; outline: none; background: #fff;
        }

        @media (min-width: 768px) { .input-field { font-size: 12px; padding: 4px 8px; } }

        .label-text { font-size: 9px; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 2px; display: block; }
        .checkbox-custom { width: 18px; height: 18px; accent-color: #e11d48; cursor: pointer; border: 1px solid #cbd5e1; border-radius: 3px; }

        .grid-table { width: 100%; border-collapse: collapse; margin-top: 4px; }
        .grid-table td { border: 1px solid #e2e8f0; padding: 4px; font-size: 10px; }
        .grid-table input { width: 100%; border: none; outline: none; font-size: 11px; background: transparent; }

        .signature-pad { border: 2px solid #e2e8f0; background: #fff; width: 100%; height: 140px; border-radius: 8px; touch-action: none; }
        
        #toast {
            visibility: hidden; min-width: 250px; background: #1e293b; color: #fff;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed;
            z-index: 10000; left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: bold;
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        .device-section { display: none; }
        .device-section.active { display: block; }

        .status-badge {
            display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px;
            border-radius: 99px; font-size: 10px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .status-online { background-color: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
        .status-offline { background-color: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .pulse {
            width: 8px; height: 8px; border-radius: 50%;
            background-color: #22c55e; animation: pulse-animation 2s infinite;
        }
        @keyframes pulse-animation {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="p-0 md:p-4">

    <div id="toast">Spr√°va</div>

    <div class="page-container max-w-[950px] mx-auto bg-white shadow-2xl border-t-[10px] border-red-600 p-4 md:p-12 min-h-screen rounded-b-lg">
        
        <!-- HLAVIƒåKA -->
        <div class="flex flex-col md:flex-row justify-between items-start border-b-2 border-slate-200 pb-6 mb-4">
            <div class="flex flex-col md:flex-row gap-6">
                <div>
                    <h1 class="text-red-600 font-[900] text-4xl italic leading-none tracking-tighter uppercase">SPEKTRA <span class="text-slate-800 font-black">install</span></h1>
                    <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mt-1 italic leading-none">Profesion√°lne rie≈°enia pre Panasonic Aquarea</p>
                    <div id="authStatusContainer" class="mt-2 no-print">
                        <div id="authBadge" class="status-badge status-offline">
                            <div id="authDot" class=""></div>
                            <span id="authText">Prip√°janie...</span>
                        </div>
                    </div>
                </div>
                <div class="text-[9px] text-slate-500 md:border-l md:pl-6 border-slate-200 leading-tight">
                    <p class="font-black text-slate-800 uppercase text-[10px]">Spektra install s.r.o.</p>
                    <p>Holl√©ho 210, 015 01 Rajec | IƒåO: 535690036</p>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="font-bold text-red-600 uppercase">Protokol ƒç.:</span>
                        <div class="flex items-center bg-red-50 rounded px-2 py-0.5 border border-red-100">
                            <input type="text" id="protocolId" class="bg-transparent border-none outline-none w-32 font-black text-red-700" value="POZ2026001">
                            <button id="btnLoad" class="no-print ml-2" title="Naƒç√≠ta≈• z cloudu">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4 md:mt-0 flex flex-col items-end gap-2">
                <h2 class="text-lg font-black uppercase text-slate-800 tracking-tight leading-none no-print italic">Sp√∫≈°≈•ac√≠ Protokol</h2>
                <select id="deviceSelector" onchange="updateDeviceView()" class="font-black text-red-600 border-2 border-red-600 rounded-lg px-4 py-2 italic bg-white outline-none text-xs cursor-pointer shadow-sm no-print">
                    <option value="tc">Tepeln√© ƒçerpadlo (Panasonic Aquarea)</option>
                    <option value="plyn">Plynov√Ω kotol</option>
                    <option value="elektro">Elektrick√Ω kotol</option>
                </select>
            </div>
        </div>

        <form id="protocolForm">
            <!-- 01. V≈†EOBECN√â INFO -->
            <div class="section-header">01. V≈°eobecn√© inform√°cie a kontakt na u≈æ√≠vateƒæa</div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 p-2">
                <div><label class="label-text">D√°tum in≈°tal√°cie</label><input type="date" id="date_inst" class="input-field" value="2026-02-27"></div>
                <div class="md:col-span-2"><label class="label-text">Adresa in≈°tal√°cie</label><input type="text" id="address" class="input-field"></div>
                <div><label class="label-text">Vonk. teplota (¬∞C)</label><input type="text" id="ext_temp" class="input-field"></div>
                <div class="md:col-span-2"><label class="label-text">U≈æ√≠vateƒæ (Meno)</label><input type="text" id="customer" class="input-field"></div>
                <div><label class="label-text">Mobil</label><input type="text" id="phone" class="input-field"></div>
                <div><label class="label-text">Email</label><input type="email" id="email" class="input-field"></div>
            </div>

            <!-- 02. KONTAKT NA MONT√Å≈ΩNIKOV -->
            <div class="section-header">02. Kontakt na mont√°≈ænikov</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-2">
                <div class="bg-slate-50 p-2 rounded border"><label class="label-text">In≈°talaƒçn√° spol. (Chladivo/K√∫renie)</label><input type="text" id="inst_company" class="input-field" value="Spektra install s.r.o."></div>
                <div class="bg-slate-50 p-2 rounded border"><label class="label-text">In≈°talat√©r - elektro (Meno/ID)</label><input type="text" id="inst_elec" class="input-field" value="¬ß22 ƒç.o. 18122868"></div>
            </div>

            <!-- 03. ZARIADENIE -->
            <div class="section-header">03. Zariadenie</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-2">
                <div class="bg-rose-50/20 p-2 rounded border border-rose-100">
                    <p class="text-red-600 font-black text-[9px] uppercase border-b border-red-100 mb-2 pb-1">Vonkaj≈°ia jednotka</p>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label-text">Model</label><input type="text" id="model_ext" class="input-field"></div>
                        <div><label class="label-text">S√©riov√© ƒç√≠slo</label><input type="text" id="sn_ext" class="input-field"></div>
                    </div>
                </div>
                <div class="bg-rose-50/20 p-2 rounded border border-rose-100">
                    <p class="text-red-600 font-black text-[9px] uppercase border-b border-red-100 mb-2 pb-1">Vn√∫torn√° jednotka</p>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="label-text">Model</label><input type="text" id="model_int" class="input-field"></div>
                        <div><label class="label-text">S√©riov√© ƒç√≠slo</label><input type="text" id="sn_int" class="input-field"></div>
                    </div>
                </div>
            </div>

            <!-- PANASONIC TC SECTION -->
            <div id="section-tc" class="device-section active">
                <div class="section-header italic text-red-600">04. Mechanick√© a elektrick√© s√∫ƒçasti</div>
                <div class="p-2 overflow-x-auto">
                    <table class="grid-table">
                        <tr><td>M1: <input type="text" id="m1"></td><td>M2: <input type="text" id="m2"></td><td>C1: <input type="text" id="c1"></td><td>C2: <input type="text" id="c2"></td></tr>
                    </table>
                </div>

                <div class="section-header">05. In≈°tal√°cia a Kontrola (Tƒå)</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-1.5 p-2 text-[10px] font-bold uppercase">
                    <div class="flex justify-between border-b pb-1"><span>Jednotka umiestnen√° podƒæa n√°vodu</span> <input type="checkbox" id="tc_placed" class="checkbox-custom" checked></div>
                    <div class="flex justify-between border-b pb-1"><span>V≈°etky ƒçasti riadne uzemnen√©</span> <input type="checkbox" id="tc_ground" class="checkbox-custom" checked></div>
                    <div class="flex justify-between border-b pb-1 text-red-600"><span>V√°kuovanie (hodnota bar)</span> <input type="text" id="tc_vacuum" class="w-16 border-b outline-none text-right"></div>
                    <div class="flex justify-between border-b pb-1 text-red-600"><span>Doplnen√© chladivo (kg)</span> <input type="text" id="tc_refrig_add" class="w-16 border-b outline-none text-right"></div>
                </div>

                <div class="section-header">06. Merania a Vodn√Ω okruh</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-2">
                    <div class="bg-slate-50 p-2 rounded border overflow-x-auto">
                        <p class="label-text text-red-600 font-black mb-1">Elektrick√© Nap√§tia (V)</p>
                        <table class="w-full grid-table text-[8px]">
                            <thead><tr><th>Stav</th><th>L1/L2</th><th>L2/L3</th><th>L3/L1</th><th>L1/N</th><th>L2/N</th><th>L3/N</th></tr></thead>
                            <tbody>
                                <tr><td>OFF</td><td><input type="text" id="v12o"></td><td><input type="text" id="v23o"></td><td><input type="text" id="v31o"></td><td><input type="text" id="v1no"></td><td><input type="text" id="v2no"></td><td><input type="text" id="v3no"></td></tr>
                                <tr><td class="text-red-600">ON</td><td><input type="text" id="v12"></td><td><input type="text" id="v23"></td><td><input type="text" id="v31"></td><td><input type="text" id="v1n"></td><td><input type="text" id="v2n"></td><td><input type="text" id="v3n"></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="bg-slate-50 p-2 rounded border">
                        <p class="label-text text-slate-600 font-black mb-1">Voda & Pr√∫d</p>
                        <div class="grid grid-cols-2 gap-2 text-[9px] font-bold uppercase">
                            <div class="flex justify-between border-b pb-0.5"><span>pH vody:</span> <input type="text" id="w_ph" class="w-10 text-right outline-none" value="7.5"></div>
                            <div class="flex justify-between border-b pb-0.5"><span>Magnet. filter:</span> <input type="checkbox" id="w_filt" class="checkbox-custom" checked></div>
                            <div class="flex justify-between border-b pb-0.5 text-red-600"><span>Prev√°dzk. pr√∫d (A):</span> <input type="text" id="amp_on" class="w-14 text-right outline-none font-bold"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- OTHER SECTIONS -->
            <div id="section-plyn" class="device-section"><div class="section-header">04. Plynov√Ω kotol - Merania</div><div class="p-2"><input type="text" id="g_co2" class="input-field" placeholder="CO2 (%)"></div></div>
            <div id="section-elektro" class="device-section"><div class="section-header">04. Elektrick√Ω kotol - Merania</div><div class="p-2"><input type="text" id="e_l1" class="input-field" placeholder="L1 (A)"></div></div>

            <!-- SIGNATURES -->
            <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-10 md:gap-16">
                <div class="flex flex-col items-center">
                    <label class="label-text mb-2 text-slate-400 uppercase">Podpis z√°kazn√≠ka</label>
                    <canvas id="customerSignature" class="signature-pad shadow-inner"></canvas>
                    <button type="button" onclick="clearSignature('customerSignature')" class="no-print mt-2 text-[10px] bg-slate-100 px-3 py-1 rounded">Reset</button>
                </div>
                <div class="flex flex-col items-center">
                    <label class="label-text mb-2 text-red-600 italic uppercase font-black">Technik (Spektra install)</label>
                    <canvas id="technicianSignature" class="signature-pad shadow-inner border-red-100"></canvas>
                    <button type="button" onclick="clearSignature('technicianSignature')" class="no-print mt-2 text-[10px] bg-slate-100 px-3 py-1 rounded text-red-600">Reset</button>
                </div>
            </div>

            <!-- ACTIONS -->
            <div class="mt-16 no-print flex flex-col items-center gap-6 pb-20">
                <div class="flex flex-wrap gap-4 w-full justify-center px-4">
                    <button type="button" id="btnSave" class="bg-zinc-800 text-white px-10 py-5 rounded-full font-black text-sm uppercase tracking-widest shadow-xl flex items-center justify-center gap-2 transform active:scale-95 transition-all">
                        üíæ Ulo≈æi≈• do Cloudu
                    </button>
                    <button type="button" id="btnArchivePreview" class="bg-amber-100 text-amber-900 border border-amber-300 px-10 py-5 rounded-full font-black text-sm uppercase tracking-widest hover:bg-amber-200 transform active:scale-95 transition-all">
                        üìÇ Otvori≈• z Arch√≠vu
                    </button>
                    <button type="button" onclick="window.print()" class="bg-red-600 text-white px-10 py-5 rounded-full font-black text-sm shadow-xl hover:bg-red-700 transition-all transform active:scale-95 uppercase tracking-widest">
                        üñ®Ô∏è Vytlaƒçi≈• PDF
                    </button>
                </div>
                <p class="text-[8px] text-slate-400 font-black uppercase tracking-[0.4em]">Spektra install v4.2 | Cloud Connected</p>
            </div>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Tvoje Firebase √∫daje
        const firebaseConfig = {
            apiKey: "AIzaSyCiKb3ZKYaTUxdtiJMI2E9QvTaEIpIHr9U",
            authDomain: "spustaci-protokol.firebaseapp.com",
            projectId: "spustaci-protokol",
            storageBucket: "spustaci-protokol.firebasestorage.app",
            messagingSenderId: "860586673764",
            appId: "1:860586673764:web:f32fd0b6a33dbf75bec171",
            measurementId: "G-WKZPTPHCMQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const appId = firebaseConfig.projectId;

        let user = null;

        // Auto Anonymous Auth
        const initAuth = async () => {
            try {
                let tokenSuccess = false;
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        tokenSuccess = true;
                    } catch (tokenErr) {
                        console.warn("Custom token mismatch (oƒçak√°van√© pri pou≈æit√≠ vlastn√©ho Firebase projektu), sk√∫≈°am anonymn√© prihl√°senie...");
                    }
                }
                
                if (!tokenSuccess) {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Auth error:", e);
                updateAuthUI(false);
                showToast("‚ö†Ô∏è Cloud odpojen√Ω. Skontrolujte pripojenie.");
            }
        };

        function updateAuthUI(isLoggedIn) {
            const badge = document.getElementById('authBadge');
            const dot = document.getElementById('authDot');
            const text = document.getElementById('authText');
            if (isLoggedIn) {
                badge.className = "status-badge status-online";
                dot.className = "pulse";
                text.innerText = "Cloud akt√≠vny";
            } else {
                badge.className = "status-badge status-offline";
                dot.className = "";
                text.innerText = "Cloud odpojen√Ω";
            }
        }

        onAuthStateChanged(auth, (u) => { 
            user = u; 
            updateAuthUI(!!u);
            if (u && !window.initialToastShown) {
                showToast("‚úÖ Pripojen√© k projektu spustaci-protokol");
                window.initialToastShown = true;
            }
        });

        initAuth();

        // Signature logic
        const pads = {};
        function initPad(id) {
            const canvas = document.getElementById(id);
            const ctx = canvas.getContext('2d');
            let drawing = false;
            ctx.strokeStyle = "#1e293b"; ctx.lineWidth = 3; ctx.lineCap = "round";
            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return { x: clientX - rect.left, y: clientY - rect.top };
            };
            const start = (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); if(e.touches) e.preventDefault(); };
            const move = (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); if(e.touches) e.preventDefault(); };
            const stop = () => drawing = false;
            canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', stop);
            canvas.addEventListener('touchstart', start, {passive: false}); canvas.addEventListener('touchmove', move, {passive: false}); canvas.addEventListener('touchend', stop);
            pads[id] = { canvas, ctx };
            canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        }
        window.clearSignature = (id) => pads[id].ctx.clearRect(0, 0, pads[id].canvas.width, pads[id].canvas.height);
        initPad('customerSignature'); initPad('technicianSignature');

        // Cloud Actions
        document.getElementById('btnSave').onclick = async () => {
            if (!user) return showToast("‚ö†Ô∏è Cloud nie je pripraven√Ω.");
            const pId = document.getElementById('protocolId').value.trim();
            if (!pId) return showToast("Zadajte ƒç√≠slo protokolu!");
            
            showToast("Uklad√°m...");
            const data = {
                metadata: { protocolId: pId, type: document.getElementById('deviceSelector').value, ts: new Date().toISOString() },
                content: {},
                signatures: { cust: pads['customerSignature'].canvas.toDataURL(), tech: pads['technicianSignature'].canvas.toDataURL() }
            };
            document.querySelectorAll('input, select').forEach(el => { 
                if(el.id && el.id !== 'protocolId') {
                    data.content[el.id] = el.type === 'checkbox' ? el.checked : el.value;
                }
            });
            try {
                // Dodr≈æanie pravidiel cesty /artifacts/{appId}/public/data/{collectionName}
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'protocols', pId);
                await setDoc(docRef, data);
                showToast("‚úÖ Protokol √∫spe≈°ne ulo≈æen√Ω!");
            } catch (e) { 
                console.error("Save Error:", e);
                showToast("‚ùå Chyba: " + (e.code === 'permission-denied' ? "Skontrolujte Firestore Rules v konzole!" : e.message));
            }
        };

        document.getElementById('btnLoad').onclick = async () => {
            const data = await fetchFromCloud();
            if (data) {
                document.getElementById('deviceSelector').value = data.metadata.type;
                updateDeviceView();
                for (const [id, val] of Object.entries(data.content)) {
                    const el = document.getElementById(id);
                    if (el) { if (el.type === 'checkbox') el.checked = val; else el.value = val; }
                }
                restoreSignature('customerSignature', data.signatures.cust);
                restoreSignature('technicianSignature', data.signatures.tech);
                showToast("‚úÖ Protokol naƒç√≠tan√Ω.");
            }
        };

        document.getElementById('btnArchivePreview').onclick = async () => {
            const data = await fetchFromCloud();
            if (data) {
                const win = window.open('', '_blank');
                win.document.write(`
                    <!DOCTYPE html>
                    <html lang="sk">
                    <head>${document.head.innerHTML}<style>.no-print { display: none !important; } body { background: white; padding: 20px; }</style></head>
                    <body>
                        <div class="page-container max-w-[950px] mx-auto bg-white p-10 border shadow-none">
                            ${document.querySelector('.page-container').innerHTML}
                        </div>
                        <script>
                            document.querySelectorAll('input, select, textarea').forEach(el => el.disabled = true);
                            document.querySelectorAll('button').forEach(el => el.remove());
                            document.getElementById('customerSignature').outerHTML = '<img src="${data.signatures.cust}" style="width:100%; border:1px solid #eee; border-radius:8px;">';
                            document.getElementById('technicianSignature').outerHTML = '<img src="${data.signatures.tech}" style="width:100%; border:1px solid #eee; border-radius:8px;">';
                            const dataVals = ${JSON.stringify(data.content)};
                            for(const [id, val] of Object.entries(dataVals)) {
                                const el = document.getElementById(id);
                                if(el) { if(el.type === 'checkbox') el.checked = val; else el.value = val; }
                            }
                        <\/script>
                    </body></html>
                `);
                win.document.close();
            }
        };

        async function fetchFromCloud() {
            if (!user) return showToast("‚ö†Ô∏è Prip√°jam sa...");
            const pId = document.getElementById('protocolId').value.trim();
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'protocols', pId);
                const snap = await getDoc(docRef);
                if (snap.exists()) return snap.data();
                showToast("‚ùå Protokol neexistuje."); return null;
            } catch (e) { showToast("‚ùå Chyba spojenia."); return null; }
        }

        function restoreSignature(id, url) {
            const ctx = pads[id].ctx;
            const img = new Image();
            img.onload = () => { ctx.clearRect(0,0,pads[id].canvas.width,pads[id].canvas.height); ctx.drawImage(img,0,0); };
            img.src = url;
        }

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerHTML = msg; x.className = "show";
            setTimeout(() => { x.className = ""; }, 3000);
        }

        window.updateDeviceView = () => {
            const sel = document.getElementById('deviceSelector').value;
            document.querySelectorAll('.device-section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + sel)?.classList.add('active');
        };
    </script>
</body>
</html>
