<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spektra install - Protokol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Montserrat:ital,wght@0,900;1,900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f1f5f9;
            color: #000;
            -webkit-tap-highlight-color: transparent;
        }

        /* Zjednotenie vzhƒæadu inputov na "text v dokumente" */
        input[type="text"], input[type="date"], input[type="email"], select, textarea { 
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            font-family: inherit;
        }
        input[type="text"]:focus, input[type="date"]:focus, input[type="email"]:focus {
            background-color: #f8fafc;
            border-bottom: 1px solid #cbd5e1;
            border-radius: 2px;
        }
        
        /* Checkbox styl */
        .checkbox-custom { width: 16px; height: 16px; accent-color: #000; cursor: pointer; border: 1px solid #000; }

        .form-box { border: 1px solid #cbd5e1; padding: 12px; border-radius: 4px; background: #fff; }
        .form-box h3 { font-size: 11px; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; color: #1e293b; border-bottom: 1px solid #f1f5f9; padding-bottom: 4px;}
        .form-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; font-size: 11px; }
        .form-row span { color: #475569; width: 120px; flex-shrink: 0; }
        .form-row input { font-weight: 700; text-align: right; }

        .section-title { 
            font-size: 12px; font-weight: 800; text-transform: uppercase; color: #000;
            border-left: 3px solid #dc2626; padding-left: 8px; margin: 20px 0 10px 0;
            display: flex; align-items: center; gap: 8px;
        }

        .data-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 16px; }
        .data-table th, .data-table td { border: 1px solid #cbd5e1; padding: 6px 8px; text-align: left; }
        .data-table th { background-color: #f8fafc; font-weight: 800; color: #1e293b; }
        .data-table input { font-weight: 700; background: transparent !important; }

        .signature-line { border-top: 1px solid #000; width: 100%; text-align: center; font-size: 10px; font-weight: 700; padding-top: 4px; margin-top: auto;}
        .signature-pad { border: 1px dashed #cbd5e1; background: #fafafa; width: 100%; height: 80px; touch-action: none; margin-bottom: 4px; }

        /* --- ≈†T√ùLY PRE DOKONAL√ö TLAƒå DO PDF NA 1 STRANU A4 --- */
        @media print {
            @page { size: A4 portrait; margin: 8mm; }
            body { background: white !important; padding: 0 !important; font-size: 9pt !important; line-height: 1.15 !important; }
            .no-print { display: none !important; }
            
            .page-container { border: none !important; box-shadow: none !important; width: 100% !important; max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
            
            /* Tlaƒçov√© zarovnanie hlaviƒçky */
            .print-header { display: flex !important; flex-direction: row !important; align-items: flex-end !important; justify-content: space-between !important; margin-bottom: 8px !important; padding-bottom: 4px !important; }
            .print-header > div { flex: 1 !important; }
            .print-left { text-align: left !important; align-items: flex-start !important; justify-content: flex-end !important; }
            .print-center { text-align: center !important; align-items: center !important; justify-content: flex-end !important; }
            .print-right { text-align: right !important; align-items: flex-end !important; justify-content: flex-end !important; }
            .print-header h1 { font-size: 20pt !important; }

            /* Grid kompresia */
            .print-grid-2 { display: grid !important; grid-template-columns: 1fr 1fr !important; gap: 8px !important; margin-bottom: 4px !important; }
            .form-box { border-color: #000 !important; break-inside: avoid; padding: 6px 8px !important; }
            .form-box h3 { margin-bottom: 4px !important; font-size: 8.5pt !important; border-bottom: 1px solid #000 !important;}
            .form-row { font-size: 8.5pt !important; margin-bottom: 1px !important; }
            
            /* Kompresia tabuliek */
            .data-table { font-size: 8.5pt !important; margin-bottom: 6px !important; }
            .data-table th, .data-table td { border-color: #000 !important; padding: 3px 4px !important; }
            .data-table th { background-color: #f1f5f9 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact;}
            
            .section-title { font-size: 9.5pt !important; border-left-color: #dc2626 !important; margin: 8px 0 3px 0 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; page-break-after: avoid; }
            
            .mb-6 { margin-bottom: 6px !important; }
            .mb-4 { margin-bottom: 4px !important; }
            .mt-6 { margin-top: 6px !important; }
            .gap-8 { gap: 16px !important; }
            p.text-\\[11px\\] { font-size: 8.5pt !important; margin-bottom: 4px !important; line-height: 1.15 !important; }
            .py-3 { padding-top: 3px !important; padding-bottom: 3px !important; }
            .my-4 { margin-top: 4px !important; margin-bottom: 4px !important; }
            
            .h-\\[90px\\] { height: 60px !important; }
            .signature-line { font-size: 7.5pt !important; padding-top: 2px !important; }
            img[alt="Raz√≠tko technika"] { max-height: 50px !important; }

            input[type="text"]:focus, input[type="date"]:focus, input[type="email"]:focus { background: transparent !important; border: none !important; }
            .signature-pad { border: none !important; background: transparent !important; }
            
            .break-inside-avoid { page-break-inside: avoid; }
            .device-section { display: none; }
            .device-section.active { display: block !important; }
        }

        #toast {
            visibility: hidden; min-width: 250px; background: #1e293b; color: #fff;
            text-align: center; border-radius: 8px; padding: 16px; position: fixed;
            z-index: 10000; left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: bold;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        #toast.show { visibility: visible; animation: fadein 0.4s, fadeout 0.4s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0; transform: translate(-50%, 20px);} to {bottom: 30px; opacity: 1; transform: translate(-50%, 0);} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1; transform: translate(-50%, 0);} to {bottom: 0; opacity: 0; transform: translate(-50%, 20px);} }

        .device-section { display: none; }
        .device-section.active { display: block; }
        
        .status-badge { display: inline-flex; align-items: center; gap: 4px; font-size: 9px; font-weight: 700; text-transform: uppercase; color: #64748b; }
        .pulse { width: 6px; height: 6px; border-radius: 50%; background-color: #22c55e; animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 4px rgba(34, 197, 94, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
    </style>
</head>
<body class="p-0 md:p-6">

    <div id="toast">Spr√°va</div>

    <div class="page-container max-w-[850px] mx-auto bg-white shadow-2xl p-6 md:p-10 min-h-screen border border-slate-200">
        
        <!-- HLAVIƒåKA -->
        <div class="flex flex-col md:flex-row justify-between items-end border-b-[3px] border-red-600 pb-3 mb-6 gap-4 break-inside-avoid print-header">
            
            <!-- ƒΩAV√Å ƒåAS≈§: Firma -->
            <div class="w-full md:w-1/3 flex flex-col items-start print-left">
                <h1 class="text-3xl tracking-tighter uppercase" style="font-family: 'Montserrat', sans-serif; font-weight: 900; line-height: 1;">
                    <span class="text-black">SPEKTRA</span> <span class="text-red-600">INSTALL</span>
                </h1>
                <p class="text-[9px] text-slate-500 mt-1 leading-tight text-left">
                    Holl√©ho 210, 015 01 Rajec | IƒåO: 535690036 | Iƒå DPH: SK2121459450<br>
                    Opr√°vnenie: 077/2/2021-PZ-S,O (OU,R,M)-Bd,f,g,h
                </p>
                <div id="authStatusContainer" class="mt-2 no-print w-full text-left">
                    <div id="authBadge" class="status-badge"><div id="authDot" class=""></div><span id="authText">Prip√°janie k datab√°ze...</span></div>
                </div>
            </div>
            
            <!-- STREDN√Å ƒåAS≈§: Zariadenie -->
            <div class="w-full md:w-1/3 flex flex-col items-center justify-end print-center">
                <select id="deviceSelector" onchange="updateDeviceView()" class="no-print border border-slate-300 rounded px-3 py-1.5 text-xs font-bold text-red-600 bg-slate-50 cursor-pointer text-center w-full md:w-auto shadow-sm">
                    <option value="tc">Tepeln√© ƒçerpadlo</option>
                    <option value="plyn">Plynov√Ω kotol</option>
                    <option value="elektro">Elektrick√Ω kotol</option>
                    <option value="pevne">Kotol na pevn√© palivo</option>
                </select>
                <!-- Tento text sa zobraz√≠ len pri tlaƒçi v strede -->
                <div id="printDeviceName" class="hidden print:block font-black text-red-600 text-[14px] uppercase tracking-widest text-center mt-1 pb-1">Tepeln√© ƒçerpadlo</div>
            </div>

            <!-- PRAV√Å ƒåAS≈§: Protokol -->
            <div class="w-full md:w-1/3 flex flex-col items-end print-right">
                <h2 class="font-black text-[15px] uppercase text-black tracking-tight mb-2 text-right">Sp√∫≈°≈•ac√≠ protokol</h2>
                <div class="border-[2px] border-black px-3 py-1 flex items-center bg-white font-bold text-[13px] justify-end w-full md:w-auto">
                    <span>ƒå√≠slo: </span>
                    <input type="text" id="protocolId" class="w-28 ml-2 font-black text-red-600 text-right outline-none bg-transparent" value="SP-2026/001">
                    <button type="button" id="btnLoad" class="no-print ml-2 hover:scale-110 transition-transform text-slate-400 hover:text-red-600" title="Naƒç√≠ta≈• z cloudu">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                    </button>
                </div>
            </div>
        </div>

        <form id="protocolForm">
            <!-- √öDAJE: 2 STƒπPCE -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 break-inside-avoid print-grid-2">
                <div class="form-box">
                    <h3>ZHOTOVITEƒΩ / √öDAJE O IN≈†TAL√ÅCII</h3>
                    <div class="form-row"><span>Spoloƒçnos≈•:</span> <input type="text" id="inst_company" value="Spektra install s.r.o."></div>
                    <div class="form-row"><span>Technik / Opr√°vnenie:</span> <input type="text" id="inst_elec" value="¬ß22 ƒç.o. 18122868"></div>
                    <div class="form-row"><span>D√°tum in≈°tal√°cie:</span> <input type="date" id="date_inst" value="2026-02-27"></div>
                    <div class="form-row"><span>Vonkaj≈°ia teplota (¬∞C):</span> <input type="text" id="ext_temp" placeholder="Napr. 5¬∞C"></div>
                </div>
                
                <div class="form-box">
                    <h3>PREV√ÅDZKOVATEƒΩ / OBJEDN√ÅVATEƒΩ</h3>
                    <div class="form-row"><span>Meno / N√°zov:</span> <input type="text" id="customer" placeholder="Zadajte meno"></div>
                    <div class="form-row"><span>Adresa / Miesto:</span> <input type="text" id="address" placeholder="Ulica, Mesto"></div>
                    <div class="form-row"><span>Telef√≥nny kontakt:</span> <input type="text" id="phone" placeholder="+421 ..."></div>
                    <div class="form-row"><span>Emailov√° adresa:</span> <input type="email" id="email" placeholder="@"></div>
                </div>
            </div>


            <!-- DYNAMICK√â SEKCIE (Zariadenie + Merania podƒæa typu) -->
            
            <!-- === TEPELN√â ƒåERPADLO === -->
            <div id="section-tc" class="device-section active">
                <div class="section-title">1. √ödaje o zariaden√≠ (Tepeln√© ƒçerpadlo)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 25%">ƒåas≈•</th><th style="width: 35%">Model / Typ</th><th style="width: 40%">S√©riov√© ƒç√≠slo (S/N)</th></tr></thead>
                    <tbody>
                        <tr><td class="font-bold text-slate-700">Vonkaj≈°ia jednotka</td><td><input type="text" id="model_ext" placeholder="Zadajte model"></td><td><input type="text" id="sn_ext" placeholder="Zadajte SN"></td></tr>
                        <tr><td class="font-bold text-slate-700">Vn√∫torn√° jednotka</td><td><input type="text" id="model_int" placeholder="Zadajte model"></td><td><input type="text" id="sn_int" placeholder="Zadajte SN"></td></tr>
                    </tbody>
                </table>

                <div class="section-title">2. V√Ωsledky meran√≠ a in≈°talaƒçn√© kontroly (Tƒå)</div>
                <table class="data-table break-inside-avoid mb-4">
                    <thead><tr><th style="width: 45%">Predmet kontroly</th><th style="width: 20%">Predp√≠san√©</th><th style="width: 20%">Nameran√© / Stav</th><th style="width: 15%">V√Ωsledok</th></tr></thead>
                    <tbody>
                        <tr><td>Jednotka umiestnen√° a ukotven√° podƒæa n√°vodu</td><td>√Åno</td><td class="text-center"><input type="checkbox" id="tc_placed" class="checkbox-custom" checked></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>V≈°etky ƒçasti riadne a bezpeƒçne uzemnen√©</td><td>√Åno</td><td class="text-center"><input type="checkbox" id="tc_ground" class="checkbox-custom" checked></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Funkƒçn√Ω magnetick√Ω filter v syst√©me</td><td>√Åno</td><td class="text-center"><input type="checkbox" id="w_filt" class="checkbox-custom" checked></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kvalita vody vo vykurovacom okruhu (pH)</td><td>7.0 - 8.5</td><td><input type="text" id="w_ph" value="7.5" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>V√°kuovanie chladiaceho okruhu (bar)</td><td>Pod 0 bar</td><td><input type="text" id="tc_vacuum" value="-1.0 bar" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Mno≈æstvo dodatoƒçne doplnen√©ho chladiva (kg)</td><td>Podƒæa dƒ∫≈æky</td><td><input type="text" id="tc_refrig_add" value="0.0 kg" class="text-center w-full font-bold"></td><td class="font-bold">OK</td></tr>
                        <tr><td>Prev√°dzkov√Ω pr√∫d kompresora (A)</td><td>Podƒæa ≈°t√≠tku</td><td><input type="text" id="amp_on" value="5.4 A" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                    </tbody>
                </table>

                <div class="section-title">3. Elektrick√© nap√§tia (Nap√°jac√≠ zdroj)</div>
                <table class="data-table break-inside-avoid text-center">
                    <thead><tr><th class="text-left">Stav zariadenia</th><th>L1 - L2 (V)</th><th>L2 - L3 (V)</th><th>L3 - L1 (V)</th><th>L1 - N (V)</th><th>L2 - N (V)</th><th>L3 - N (V)</th></tr></thead>
                    <tbody>
                        <tr><td class="text-left font-bold">Vypnut√© (OFF)</td><td><input type="text" id="v12o" class="text-center w-full" value="0"></td><td><input type="text" id="v23o" class="text-center w-full" value="0"></td><td><input type="text" id="v31o" class="text-center w-full" value="0"></td><td><input type="text" id="v1no" class="text-center w-full" value="0"></td><td><input type="text" id="v2no" class="text-center w-full" value="0"></td><td><input type="text" id="v3no" class="text-center w-full" value="0"></td></tr>
                        <tr><td class="text-left font-bold text-red-600">Zapnut√© (ON)</td><td><input type="text" id="v12" class="text-center w-full font-bold" value="400"></td><td><input type="text" id="v23" class="text-center w-full font-bold" value="402"></td><td><input type="text" id="v31" class="text-center w-full font-bold" value="401"></td><td><input type="text" id="v1n" class="text-center w-full font-bold" value="230"></td><td><input type="text" id="v2n" class="text-center w-full font-bold" value="232"></td><td><input type="text" id="v3n" class="text-center w-full font-bold" value="231"></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- === PLYNOV√ù KOTOL === -->
            <div id="section-plyn" class="device-section">
                <div class="section-title">1. √ödaje o zariaden√≠ (Plynov√Ω kotol)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 25%">ƒåas≈•</th><th style="width: 35%">Znaƒçka / Model</th><th style="width: 40%">S√©riov√© ƒç√≠slo (S/N)</th></tr></thead>
                    <tbody>
                        <tr><td class="font-bold text-slate-700">Plynov√Ω kotol</td><td><input type="text" id="model_plyn" placeholder="Zadajte model"></td><td><input type="text" id="sn_plyn" placeholder="Zadajte SN"></td></tr>
                        <tr><td class="font-bold text-slate-700">Regul√°cia / Termostat</td><td><input type="text" id="model_reg_plyn" placeholder="Zadajte model"></td><td><input type="text" id="sn_reg_plyn" placeholder="Zadajte SN"></td></tr>
                    </tbody>
                </table>

                <div class="section-title">2. V√Ωsledky meran√≠ a sk√∫≈°ok (Plyn)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 45%">Predmet kontroly</th><th style="width: 20%">Predp√≠san√©</th><th style="width: 20%">Nameran√©</th><th style="width: 15%">V√Ωsledok</th></tr></thead>
                    <tbody>
                        <tr><td>Tlak plynu na vstupe (HUP)</td><td>1.8 - 2.5 kPa</td><td><input type="text" id="g_tlak" value="2.1 kPa" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Tesnos≈• spojov (detektor)</td><td>0 ppm</td><td><input type="text" id="g_tesnost" value="0 ppm" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Koncentr√°cia CO v spalin√°ch</td><td>&lt; 100 ppm</td><td><input type="text" id="g_co" value="14 ppm" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>≈§ah kom√≠na / Teplota spal√≠n</td><td>min. 3 Pa</td><td><input type="text" id="g_tah" value="12 Pa" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Funkcia blokovac√≠ch prvkov</td><td>vypnutie &lt; 1 s</td><td><input type="text" id="g_blok" value="0.5 s" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Tlak vo vykurovacej s√∫stave</td><td>1.0 - 2.0 bar</td><td><input type="text" id="g_tlakvody" value="1.5 bar" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kontrola expanznej n√°doby a regul√°cie</td><td>Funkƒçn√° / Plynul√°</td><td><input type="text" id="g_expanz" value="OK" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kontrola hor√°ka a v√Ωmenn√≠ka</td><td>ƒåist√©</td><td><input type="text" id="g_horak" value="Bez z√°vad" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- === ELEKTRICK√ù KOTOL === -->
            <div id="section-elektro" class="device-section">
                <div class="section-title">1. √ödaje o zariaden√≠ (Elektrick√Ω kotol)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 25%">ƒåas≈•</th><th style="width: 35%">Znaƒçka / Model</th><th style="width: 40%">S√©riov√© ƒç√≠slo (S/N)</th></tr></thead>
                    <tbody>
                        <tr><td class="font-bold text-slate-700">Elektrick√Ω kotol</td><td><input type="text" id="model_el" placeholder="Zadajte model"></td><td><input type="text" id="sn_el" placeholder="Zadajte SN"></td></tr>
                        <tr><td class="font-bold text-slate-700">Z√°sobn√≠k T√öV / Pr√≠slu≈°enstvo</td><td><input type="text" id="model_bojler" placeholder="Zadajte model (voliteƒæn√©)"></td><td><input type="text" id="sn_bojler" placeholder="Zadajte SN"></td></tr>
                    </tbody>
                </table>

                <div class="section-title">2. V√Ωsledky meran√≠ a sk√∫≈°ok (Elektro)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 45%">Predmet kontroly</th><th style="width: 20%">Predp√≠san√©</th><th style="width: 20%">Nameran√© / Stav</th><th style="width: 15%">V√Ωsledok</th></tr></thead>
                    <tbody>
                        <tr><td>Tlak vo vykurovacej s√∫stave</td><td>1.0 - 2.0 bar</td><td><input type="text" id="e_tlakvody" value="1.5 bar" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kontrola expanznej n√°doby a ƒçerpadla</td><td>Funkƒçn√©</td><td><input type="text" id="e_expanz" value="OK" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Odber pr√∫du v plnej z√°≈•a≈æi - F√°za L1 (A)</td><td>Podƒæa v√Ωkonu</td><td><input type="text" id="e_l1" value="13.2 A" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Odber pr√∫du v plnej z√°≈•a≈æi - F√°za L2 (A)</td><td>Podƒæa v√Ωkonu</td><td><input type="text" id="e_l2" value="13.1 A" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Odber pr√∫du v plnej z√°≈•a≈æi - F√°za L3 (A)</td><td>Podƒæa v√Ωkonu</td><td><input type="text" id="e_l3" value="13.3 A" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Prierez nap√°jacieho k√°bla a istenie</td><td>Zodpoved√° norm√°m</td><td><input type="text" id="e_kabel" value="OK" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Sk√∫≈°ka bezpeƒçnostn√©ho termostatu</td><td>Vypnutie pri 95¬∞C</td><td><input type="text" id="e_bezp_term" value="OK" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kontrola poistn√©ho ventilu (UK)</td><td>2.5 - 3.0 bar</td><td><input type="text" id="e_poistny" value="2.5 bar" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- === KOTOL NA PEVN√â PALIVO === -->
            <div id="section-pevne" class="device-section">
                <div class="section-title">1. √ödaje o zariaden√≠ (Kotol na pevn√© palivo)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 25%">ƒåas≈•</th><th style="width: 35%">Znaƒçka / Model</th><th style="width: 40%">S√©riov√© ƒç√≠slo (S/N)</th></tr></thead>
                    <tbody>
                        <tr><td class="font-bold text-slate-700">Kotol na pevn√© palivo</td><td><input type="text" id="model_pevne" placeholder="Zadajte model"></td><td><input type="text" id="sn_pevne" placeholder="Zadajte SN"></td></tr>
                        <tr><td class="font-bold text-slate-700">Zmie≈°avacia skupina / Regul√°cia</td><td><input type="text" id="model_reg_pevne" placeholder="Zadajte model"></td><td><input type="text" id="sn_reg_pevne" placeholder="Zadajte SN"></td></tr>
                    </tbody>
                </table>

                <div class="section-title">2. V√Ωsledky meran√≠ a sk√∫≈°ok (Pevn√© palivo)</div>
                <table class="data-table break-inside-avoid">
                    <thead><tr><th style="width: 45%">Predmet kontroly</th><th style="width: 20%">Predp√≠san√©</th><th style="width: 20%">Nameran√© / Stav</th><th style="width: 15%">V√Ωsledok</th></tr></thead>
                    <tbody>
                        <tr><td>Tlak vo vykurovacej s√∫stave</td><td>1.0 - 2.0 bar</td><td><input type="text" id="p_tlakvody" value="1.5 bar" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Teplota spal√≠n (pri ust√°lenej prev√°dzke)</td><td>&lt; 200 ¬∞C</td><td><input type="text" id="p_temp_spalin" value="165 ¬∞C" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>≈§ah kom√≠na (meran√Ω)</td><td>min. 15 Pa</td><td><input type="text" id="p_tah" value="18 Pa" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Teplota vratnej vody (ochrana spiatoƒçky)</td><td>min. 55 ¬∞C</td><td><input type="text" id="p_vratna" value="60 ¬∞C" class="text-center w-full font-bold text-red-600"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Funkƒçnos≈• zmie≈°avacieho ventilu</td><td>Plynul√°</td><td class="text-center"><input type="checkbox" id="p_zmiesavac" class="checkbox-custom" checked></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Zapojenie chladiacej sluƒçky (DBV ventil)</td><td>Funkƒçn√©</td><td class="text-center"><input type="checkbox" id="p_slucka" class="checkbox-custom" checked></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Poistn√Ω ventil √∫stredn√©ho k√∫renia</td><td>2.5 - 3.0 bar</td><td><input type="text" id="p_poistny" value="2.5 bar" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                        <tr><td>Kontrola dymovodu a tesnosti</td><td>Bez z√°vad</td><td><input type="text" id="p_dymovod" value="OK" class="text-center w-full font-bold"></td><td class="font-bold">Vyhovuje</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- POZN√ÅMKY -->
            <div class="section-title">Ostatn√© zistenia / Pozn√°mky</div>
            <div class="border border-cbd5e1 bg-white p-2 break-inside-avoid mb-6">
                <textarea id="notes" rows="2" class="w-full resize-none outline-none font-medium text-[11px]" placeholder="Zariadenie bolo zapojen√© bez z√°vad. Odovzdan√© u≈æ√≠vateƒæovi."></textarea>
            </div>

            <!-- Z√ÅVER (ZELEN√ù BOX) -->
            <div class="break-inside-avoid mb-6">
                <div class="section-title">Celkov√© hodnotenie a z√°ver</div>
                <p class="text-[11px] text-justify mb-3">
                    Zariadenie bolo nain≈°talovan√© a zapojen√© podƒæa technickej dokument√°cie a pokynov v√Ωrobcu. Funkƒçn√© sk√∫≈°ky a merania preuk√°zali, ≈æe zariadenie je prev√°dzkyschopn√© a spƒ∫≈àa technick√© normy pre bezpeƒçn√∫ prev√°dzku. Nasleduj√∫ca pravideln√° servisn√° prehliadka sa odpor√∫ƒça vykona≈• v zmysle z√°ruƒçn√Ωch podmienok o 1 rok od d√°tumu in≈°tal√°cie.
                </p>
                <div class="border-2 border-green-600 py-3 text-center my-4 bg-green-50">
                    <h3 class="text-green-700 font-bold uppercase text-[12px] tracking-wide m-0">Zariadenie je sp√¥sobil√© bezpeƒçnej prev√°dzky</h3>
                </div>
            </div>

            <!-- PODPISY -->
            <div class="grid grid-cols-3 gap-8 mt-6 break-inside-avoid">
                <!-- D√°tum -->
                <div class="flex flex-col justify-end items-center h-[90px]">
                    <div class="w-full text-center font-bold text-sm mb-1" id="sig_date_display">27.02.2026</div>
                    <div class="signature-line">D√°tum</div>
                </div>

                <!-- Z√°kazn√≠k -->
                <div class="flex flex-col justify-end items-center h-[90px] relative">
                    <canvas id="customerSignature" class="signature-pad absolute top-0 left-0"></canvas>
                    <button type="button" onclick="clearSignature('customerSignature')" class="no-print absolute top-[-20px] text-[9px] bg-slate-200 px-2 py-0.5 rounded cursor-pointer">Zmaza≈•</button>
                    <div class="signature-line z-10 bg-white/50 w-full mt-auto">Podpis prev√°dzkovateƒæa / z√°kazn√≠ka</div>
                </div>

                <!-- Technik -->
                <div class="flex flex-col justify-end items-center h-[90px] relative">
                    <div class="absolute top-[-20px] left-0 w-full h-[110px] flex items-center justify-center">
                        <img src="Razitko a podpis.jpg" alt="Raz√≠tko technika" class="max-h-full max-w-[150%] object-contain mix-blend-multiply opacity-90" onerror="this.onerror=null; this.style.display='none';">
                    </div>
                    <div class="signature-line z-10 bg-white/50 w-full mt-auto">Uv√°dzac√≠ technik (Spektra install)</div>
                </div>
            </div>

            <!-- AKCIE -->
            <div class="mt-16 no-print flex flex-col items-center gap-4 border-t border-slate-200 pt-8 pb-10 break-inside-avoid">
                <div class="flex flex-wrap gap-4 w-full justify-center">
                    <button type="button" id="btnSave" class="bg-black text-white px-6 py-3 rounded text-xs font-bold uppercase tracking-wider shadow hover:bg-slate-800 transition-colors flex items-center gap-2">
                        üíæ Ulo≈æi≈• do DB
                    </button>
                    <button type="button" id="btnArchivePreview" class="bg-slate-200 text-slate-800 px-6 py-3 rounded text-xs font-bold uppercase tracking-wider shadow hover:bg-slate-300 transition-colors">
                        üìÇ Zobrazi≈• Arch√≠v
                    </button>
                    <button type="button" onclick="window.print()" class="bg-red-600 text-white px-6 py-3 rounded text-xs font-bold uppercase tracking-wider shadow hover:bg-red-700 transition-colors">
                        üñ®Ô∏è Vytlaƒçi≈• PDF
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Tvoje Firebase √∫daje
        const firebaseConfig = {
            apiKey: "AIzaSyCiKb3ZKYaTUxdtiJMI2E9QvTaEIpIHr9U",
            authDomain: "spustaci-protokol.firebaseapp.com",
            projectId: "spustaci-protokol",
            storageBucket: "spustaci-protokol.firebasestorage.app",
            messagingSenderId: "860586673764",
            appId: "1:860586673764:web:f32fd0b6a33dbf75bec171",
            measurementId: "G-WKZPTPHCMQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const appId = firebaseConfig.projectId;
        let user = null;

        // Sync D√°tumu pre podpis
        document.getElementById('date_inst').addEventListener('change', function(e) {
            const dateStr = e.target.value;
            if(dateStr) {
                const parts = dateStr.split('-');
                document.getElementById('sig_date_display').innerText = `${parts[2]}.${parts[1]}.${parts[0]}`;
            }
        });

        // Prihlasovacia logika
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try { await signInWithCustomToken(auth, __initial_auth_token); } 
                    catch (tokenErr) { await signInAnonymously(auth); }
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Auth error:", e);
                updateAuthUI(false);
            }
        };

        function updateAuthUI(isLoggedIn) {
            const badge = document.getElementById('authBadge');
            const dot = document.getElementById('authDot');
            const text = document.getElementById('authText');
            if (isLoggedIn) {
                badge.innerHTML = '<div class="pulse"></div><span class="text-green-600 font-bold">Cloud akt√≠vny</span>';
            } else {
                badge.innerHTML = '<span class="text-red-600 font-bold">Odpojen√©</span>';
            }
        }

        onAuthStateChanged(auth, (u) => { 
            user = u; 
            updateAuthUI(!!u);
        });

        initAuth();

        // Podpisov√© pl√°tno pre z√°kazn√≠ka
        const pads = {};
        function initPad(id) {
            const canvas = document.getElementById(id);
            if (!canvas) return; 
            const ctx = canvas.getContext('2d');
            let drawing = false;
            ctx.strokeStyle = "#0f172a"; ctx.lineWidth = 2.5; ctx.lineCap = "round";
            
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas(); // init size

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return { x: clientX - rect.left, y: clientY - rect.top };
            };
            const start = (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); if(e.touches) e.preventDefault(); };
            const move = (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); if(e.touches) e.preventDefault(); };
            const stop = () => drawing = false;
            
            canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', stop);
            canvas.addEventListener('touchstart', start, {passive: false}); canvas.addEventListener('touchmove', move, {passive: false}); canvas.addEventListener('touchend', stop);
            pads[id] = { canvas, ctx };
        }
        
        window.clearSignature = (id) => {
            if (pads[id]) pads[id].ctx.clearRect(0, 0, pads[id].canvas.width, pads[id].canvas.height);
        };
        setTimeout(() => initPad('customerSignature'), 100);

        // Synchroniz√°cia textu zariadenia do hlaviƒçky (na stred pre tlaƒç)
        window.updateDeviceView = () => {
            const sel = document.getElementById('deviceSelector');
            const printLabel = document.getElementById('printDeviceName');
            
            if (printLabel && sel) {
                printLabel.innerText = sel.options[sel.selectedIndex].text;
            }
            
            document.querySelectorAll('.device-section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + sel?.value)?.classList.add('active');
        };

        // Ukladanie do cloudu
        document.getElementById('btnSave').onclick = async () => {
            if (!user) return showToast("‚ö†Ô∏è Cloud nie je pripraven√Ω.");
            const pId = document.getElementById('protocolId').value.trim();
            if (!pId) return showToast("Zadajte ƒç√≠slo protokolu!");
            
            showToast("Uklad√°m...");
            const data = {
                metadata: { protocolId: pId, type: document.getElementById('deviceSelector').value, ts: new Date().toISOString() },
                content: {},
                signatures: { cust: pads['customerSignature'].canvas.toDataURL() }
            };
            document.querySelectorAll('input, select, textarea').forEach(el => { 
                if(el.id && el.id !== 'protocolId') {
                    data.content[el.id] = el.type === 'checkbox' ? el.checked : el.value;
                }
            });
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'protocols', pId);
                await setDoc(docRef, data);
                showToast("‚úÖ Ulo≈æen√© v DB!");
            } catch (e) { 
                showToast("‚ùå Chyba: " + e.message);
            }
        };

        // Otvorenie z arch√≠vu pre tlaƒç
        document.getElementById('btnArchivePreview').onclick = async () => {
            if (!user) { showToast("‚ö†Ô∏è Prip√°jam sa..."); return; }
            const pId = document.getElementById('protocolId').value.trim();
            
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'protocols', pId);
                const snap = await getDoc(docRef);
                
                if (!snap.exists()) {
                    showToast("‚ùå Nen√°jden√© v DB.");
                    return;
                }
                
                const data = snap.data();
                const win = window.open('', '_blank');
                if (!win) { showToast("‚ö†Ô∏è Prehliadaƒç zablokoval okno."); return; }
                
                win.document.write(`
                    <!DOCTYPE html>
                    <html lang="sk">
                    <head>${document.head.innerHTML}</head>
                    <body>
                        <div class="page-container max-w-[850px] mx-auto bg-white p-6 shadow-none border-none">
                            ${document.querySelector('.page-container').innerHTML}
                        </div>
                        <script>
                            // Zablokuj inputs a odstr√°n akƒçn√© prvky
                            document.querySelectorAll('input, select, textarea').forEach(el => {
                                el.disabled = true;
                                if(el.type !== 'checkbox') el.style.borderBottom = 'none'; // pre ultra ƒçist√Ω print
                            });
                            document.querySelectorAll('.no-print, button').forEach(el => el.remove());
                            
                            // Nahraƒè canvas obr√°zkom (v√Ωrazne zmen≈°en√© pre print na A4)
                            if ("${data.signatures && data.signatures.cust}" !== "undefined") {
                                const custSig = document.getElementById('customerSignature');
                                if (custSig) {
                                    custSig.outerHTML = '<img src="${data.signatures.cust}" style="width:100%; height:50px; object-fit:contain; background:transparent;">';
                                }
                            }
                            
                            // Vyber spr√°vny pr√≠stroj z arch√≠vu a aktualizuj n√°pis v strede
                            const selType = "${data.metadata.type}";
                            const sel = document.getElementById('deviceSelector');
                            if(sel) {
                                sel.value = selType;
                                const printLabel = document.getElementById('printDeviceName');
                                if(printLabel) printLabel.innerText = sel.options[sel.selectedIndex].text;
                            }
                            document.querySelectorAll('.device-section').forEach(s => s.classList.remove('active'));
                            document.getElementById('section-' + selType)?.classList.add('active');

                            // Vypl≈à d√°ta
                            const dataVals = ${JSON.stringify(data.content)};
                            for(const [id, val] of Object.entries(dataVals)) {
                                const el = document.getElementById(id);
                                if(el) { 
                                    if(el.type === 'checkbox') el.checked = val; 
                                    else el.value = val; 
                                    
                                    // Spusti sync d√°tumu
                                    if(id === 'date_inst' && val) {
                                        const p = val.split('-');
                                        document.getElementById('sig_date_display').innerText = \`\${p[2]}.\${p[1]}.\${p[0]}\`;
                                    }
                                }
                            }
                            
                            // Vyvolaj print dial√≥g
                            setTimeout(() => { window.print(); }, 500);
                        <\/script>
                    </body></html>
                `);
                win.document.close();
                showToast("‚úÖ Arch√≠v otvoren√Ω.");
                
            } catch (e) { 
                showToast("‚ùå Chyba siete.");
            }
        };

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerHTML = msg; x.className = "show";
            setTimeout(() => { x.className = ""; }, 3000);
        }

    </script>
</body>
</html>
